<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
              
<mapper namespace="kr.co.gotthem.mybatis.basketMapper">

	<select id="list" resultType="kr.co.gotthem.basket.bean.BasketBean">
		select * from basket
	</select>
	
	<select id="FindByNo" resultType="kr.co.gotthem.basket.bean.BasketBean">
		select * from basket where bas_no = #{bas_no}
	</select>
	
	<insert id="insert" parameterType="kr.co.gotthem.basket.bean.BasketBean">
		insert into basket
		values(basket_seq.nextval,#{bas_menno},#{bas_procode},#{bas_proname},#{bas_stono},
		#{bas_prostock},#{bas_proprice},#{bas_procategory},#{bas_proexdate})
	</insert>
	
	<select id="totalCount" resultType="Integer">
		select count(*) from basket
	</select>
	
	<update id="update" parameterType="kr.co.gotthem.basket.bean.BasketBean">
		update basket set bas_prostock=#{bas_prostock} where bas_no = #{bas_no}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from basket where bas_no = #{bas_no}
	</delete>

    <!-- 2. 장바구니 목록 -->
    <select id="listCart" resultType="kr.co.gotthem.basket.bean.BasketBean">
        SELECT
            b.bas_no AS bas_no, 
            b.bas_memno AS bas_memno,
            p.pro_code As pro_code,
            m.mem_no AS mem_no, 
            p.pro_name AS pro_name,         
     b.bas_prostock, p.pro_price AS productPrice,(pro_price * bas_prostock) money
        FROM
            member m, product p, basket b
        WHERE m.mem_no = b.bas_memno
            AND p.pro_code = b.bas_procode
            AND b.bas_memno = #{bas_memno}
        ORDER BY
            b.bas_no
    </select>
    
    <!-- 3. 장바구니 전체 금액 -->
    <select id="sumMoney" resultType="int">
        SELECT IFNULL(SUM(pro_price * bas_prostock), 0)
        FROM basket b,product p
        WHERE b.bas_procode = p.pro_code AND b.bas_memno = #{mem_no}
    </select>


	<!-- 6. 장바구니에 동일한 상품 레코드 확인 -->
    <select id="countBasket" resultType="int">
        select count(*) from basket
        WHERE bas_memno= #{userNo} AND bas_procode = #{bas_procode}
    </select>
    
    <!-- 7. 장바구니에 동일한 상품이 존재하면 수정 -->
    <update id="updateCart">
        UPDATE basket 
        SET bas_proprice = bas_proprice + #{bas_proprice} 
        WHERE bas_menno= #{bas_menno} AND bas_procode = #{bas_procode}
    </update>
	
</mapper>
